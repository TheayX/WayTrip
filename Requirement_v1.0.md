# Requirement.md
> 项目：基于协同过滤推荐算法的个性化旅游推荐系统（微信小程序 + Web 管理后台）  
> 版本：v1.0（规范化排版与术语；不改变已确认需求）  
> 更新日期：2026-01-09  
> 文档定位：**需求说明与验收依据**（不包含设计 / 数据库 / API / 任务拆分）

---

## 目录
- 1. 背景与目标
- 2. 系统范围
- 3. 关键决策与 Backlog
- 4. 用户角色与权限
- 5. 功能需求
  - 5.1 小程序端（User Client）
  - 5.2 管理后台（Admin Panel - Web）
- 6. 非功能需求
- 7. 验收标准
- 8. 里程碑与交付物
- 9. 术语表
- 10. 变更记录

---

## 1. 背景与目标
### 1.1 背景
旅游信息量大，用户难以快速发现符合自身偏好的景点与攻略。本项目通过微信小程序提供浏览、搜索、攻略阅读与购票下单，并通过协同过滤（ItemCF）实现个性化推荐；配套 Web 管理后台用于内容维护与演示数据管理。

### 1.2 项目目标
- 小程序端实现“一站式体验”：景点发现 → 导航 → 评分/收藏 → 购票下单（模拟支付）。
- 实现最小可用的 **ItemCF 个性化推荐**，支持论文实验与演示。
- 管理后台支持景点/攻略维护与订单/用户查看，保证数据可控。

### 1.3 非目标
- 不对接第三方票务平台实时库存。
- 不做复杂多日行程规划。
- 本期不实现微信支付全链路与退款。
- 本期不实现 UGC 攻略与审核体系。

---

## 2. 系统范围
### 2.1 In Scope（本期交付）
- **微信小程序**：登录认证、首页与推荐、景点浏览与搜索、景点详情、导航跳转、攻略浏览、推荐中心、评分评论、收藏、下单与订单、模拟支付、个人中心。
- **Web 管理后台**：管理员登录、景点管理、攻略管理、订单查看与状态维护、用户列表。
- **推荐**：基础版 ItemCF + 冷启动（热门/最新 + 偏好标签引导）。
- **测试**：黑盒（功能）+ 白盒（关键模块）。
- **列表分页**：景点/攻略/订单/后台列表均支持分页（至少“加载更多/下一页”）。
- **初始数据准备**：通过数据库 SQL 脚本/手工插入导入演示数据（不要求后台批量导入功能）。

### 2.2 Out of Scope（本期不验收）
见第 3 章 Backlog。

---

## 3. 关键决策与 Backlog
### 3.1 已确认关键决策（本期按此实现）
- 推荐算法：**ItemCF（基础版）**。
- 数据来源：**显式评分（1~5）为主**；行为日志用于**统计/过滤**，暂不做隐式融合。
- 冷启动：热门/最新 + 引导用户选择偏好标签。
- 支付：**模拟支付**（验收范围内）；预留后续接入微信支付扩展点。
- 导航：不做复杂应用内地图；使用 **wx.openLocation** 跳转导航。
- 攻略：**PGC（管理员发布）**。
- Banner：**仅跳转景点详情页**。
- 评分：随时可评；同一用户对同一景点允许更新（保留最新）。
- 订单：状态集合为 **待支付 / 待使用 / 已完成 / 已取消**；取消支持幂等；完成由后台手动标记。
- 推荐过滤：猜你喜欢过滤已评分/已收藏/已下单（未取消）的景点；已取消订单允许再次推荐。
- 距离排序：本期不做。

### 3.2 Backlog（后续可能做）
- 微信支付接入（商户号/回调验签/退款等）。
- UGC 攻略发布与审核/举报/敏感词。
- AI 生成攻略（接入 DeepSeek/ChatGPT 等）。
- 距离排序（景点列表按距离）。
- 行为转隐式评分并与显式评分融合（更复杂推荐）。
- 实时推荐/增量更新。
- 推荐理由/可解释性增强（“为什么推荐给我”）。
- 更复杂的订单核销与库存（二维码核销、每日库存等）。
- 后台批量导入（Excel/CSV）。

---

## 4. 用户角色与权限
### 4.1 角色
- **用户（User）**：使用小程序浏览/搜索、收藏、评分评论、下单、查看订单、获取推荐。
- **管理员（Admin）**：使用 Web 管理后台维护景点/攻略，查看订单与用户列表，维护订单状态。

### 4.2 权限原则
- 用户仅能操作自己的收藏/评分/订单数据。
- 管理员可对内容与订单进行全局管理（不涉及敏感信息对外展示）。

---

## 5. 功能需求（Functional Requirements）
> 编号规则：  
> - 小程序端：UC-模块-序号（例如 UC-AUTH-01）  
> - 管理后台：AD-模块-序号（例如 AD-ATTR-01）  
> 需求中出现的实现名（如 wx.openLocation）仅用于明确需求边界，不视为详细设计。

### 5.1 小程序端（User Client）
#### 5.1.1 用户认证（AUTH）
**UC-AUTH-01 一键登录/注册**
- 用户端调用 `wx.login` 获取 code；服务端换取 OpenID/SessionKey。
- 若数据库中无该 OpenID，则自动创建用户记录并完成登录；否则直接登录。
- 验收：首次登录自动建档；再次登录识别同一用户；不重复创建用户。

**UC-AUTH-02 用户信息（昵称/头像）**
- 支持展示默认昵称/头像（若可获取），并支持用户在个人中心手动完善。
- 验收：用户可修改昵称（头像可选），修改后即时生效。

#### 5.1.2 首页与推荐（HOME/REC）
**UC-HOME-01 轮播图（Banner）**
- 展示管理员置顶内容。
- 点击 **仅跳转景点详情页**。
- 验收：后台配置后小程序可见；点击进入正确景点详情。

**UC-HOME-02 热门推荐**
- 展示全局热度排行（基于点击量或评分等，公式在设计阶段确定）。
- 验收：热门列表可见且可进入详情。

**UC-REC-01 猜你喜欢（ItemCF 推荐）**
- 展示 ItemCF 计算出的推荐列表（Top-N）。
- 冷启动：交互不足（默认 < 3）时展示热门/最新，并引导选择偏好标签。
- 过滤：猜你喜欢需过滤已评分/已收藏/已下单（待支付/待使用/已完成）的景点；已取消订单景点允许再次推荐。
- 验收：交互≥3 的用户推荐列表与热门榜不完全一致；推荐结果不包含已交互景点；新用户不报错。

**UC-REC-02 推荐刷新**
- 支持“换一批”。
- 验收：操作可用，列表可刷新（可简单实现）。

#### 5.1.3 景点浏览与搜索（ATTR/SEARCH）
**UC-ATTR-01 景点列表**
- 支持筛选：地区、类型/主题。
- 支持排序：热度/评分/价格。
- 支持分页（加载更多/下一页）。
- 验收：筛选/排序/分页可用。

**UC-SEARCH-01 景点搜索**
- 支持景点名称模糊搜索。
- 验收：有结果正确返回；无结果提示“暂无结果”。

**UC-ATTR-02 景点详情**
- 展示：图片、简介、票价、开放时间、地址（或定位描述）。
- 入口：评分、收藏、下单、导航。
- 验收：详情信息完整，入口可用。

**UC-NAV-01 导航跳转**
- 点击“去这里”调用 `wx.openLocation`（lat/lng/name/address）跳转导航。
- 验收：可打开导航页面，坐标正确；定位授权拒绝不影响打开导航页面。

#### 5.1.4 旅游攻略（GUIDE）
**UC-GUIDE-01 攻略列表与详情（PGC）**
- 攻略由管理员发布，支持图文混排展示。
- 列表支持分类或时间排序（至少一种），支持分页。
- 验收：发布后小程序可见；详情图文渲染正常。

#### 5.1.5 评分与评论（RATE/COMMENT）
**UC-RATE-01 随时评分（1~5）**
- 用户可随时对景点评分，不依赖订单完成。
- 同一用户对同一景点允许更新评分（保留最新）。
- 验收：评分提交成功；再次评分会更新；评分数据可用于推荐。

**UC-COMMENT-01 文字评论**
- 支持文字评论（图片评论为 Backlog）。
- 验收：评论可提交并展示。

#### 5.1.6 收藏（FAV）
**UC-FAV-01 收藏/取消收藏**
- 景点支持收藏与取消收藏。
- 验收：收藏状态即时生效；“我的收藏”列表可进入详情。

#### 5.1.7 下单与订单（ORDER）
**UC-ORDER-01 下单**
- 用户选择游玩日期、数量、联系人生成订单。
- 订单初始状态：**待支付**。
- 验收：订单创建成功并在列表可见。

**UC-ORDER-02 模拟支付**
- 流程：立即支付 → 模拟加载 → 支付成功。
- 状态流转：待支付 → **待使用**。
- 要求：支付幂等（重复点击不产生重复支付结果）。
- 验收：状态变更正确，刷新后不回退。

**UC-ORDER-03 订单列表与筛选**
- 状态集合：待支付/待使用/已完成/已取消。
- 筛选入口：全部、待支付、待使用、已完成、已取消。
- 支持分页。
- 验收：筛选与分页可用；订单详情信息完整。

**UC-ORDER-04 取消订单**
- 待支付/待使用可取消 → 已取消；已完成不可取消。
- 取消幂等。
- 验收：取消后状态同步到列表与详情；重复取消不报错。

**UC-ORDER-05 订单完成**
- 本期由管理后台将待使用标记为已完成（用于演示闭环）。
- 验收：后台标记后用户端同步显示已完成。

#### 5.1.8 个人中心（ME）
**UC-ME-01 个人中心首页**
- 展示用户昵称/头像/偏好标签（如已设置）。

**UC-ME-02 我的订单入口**
- 可进入订单列表。

**UC-ME-03 我的收藏入口**
- 可进入收藏列表。

**UC-ME-04 客服（模拟）**
- 提供客服入口（电话/二维码/静态页均可）。
- 验收：点击可打开，不报错。

---

### 5.2 管理后台（Admin Panel - Web）
#### 5.2.1 管理员认证（AUTH）
**AD-AUTH-01 管理员登录**
- 账号密码登录。
- 验收：登录成功进入后台；未登录访问受限页面被拦截。

#### 5.2.2 景点管理（ATTR）
**AD-ATTR-01 景点增删改查（基础）**
- 新增/编辑/上下架景点。
- 包含经纬度字段（用于导航）。
- 验收：后台变更后，小程序端列表/详情可见变化。

#### 5.2.3 攻略管理（GUIDE）
**AD-GUIDE-01 攻略发布与编辑**
- 发布/编辑/上下架攻略。
- 验收：发布后小程序可见；下架后小程序不可见（或提示不可用）。

#### 5.2.4 订单管理（ORDER）
**AD-ORDER-01 订单查看**
- 查看全量订单流水，支持按时间/状态筛选（至少一种）。
- 验收：可检索到订单并查看详情。

**AD-ORDER-02 订单状态维护**
- 将订单从待使用标记为已完成。
- 验收：用户端同步展示已完成；不允许不合理回退（例如已完成回到待使用）。

#### 5.2.5 用户管理（USER）
**AD-USER-01 用户列表（只读）**
- 查看注册用户列表（OpenID 对前台不展示，后台可脱敏）。
- 验收：可查看用户数量与基本信息（昵称、注册时间等）。

---

## 6. 非功能需求（NFR）
### 6.1 性能（演示环境）
- 首页：P95 < 1.0s  
- 搜索：P95 < 2.0s  
- 推荐查询（离线）：P95 < 0.8s

### 6.2 安全与隐私
- 小程序端 token 鉴权访问后端；管理后台密码采用 hash+salt 存储。
- 日志不输出敏感信息；不对外暴露 OpenID 等敏感标识。

### 6.3 可用性与兼容性
- 下单/支付/取消均需幂等；网络异常可重试且不重复提交。
- 定位授权拒绝不影响打开导航（仍可基于目的地坐标）。
- 兼容主流微信版本。

---

## 7. 验收标准（Acceptance Criteria）
### 7.1 数据准备
- 通过 SQL 脚本/手工插入完成景点/攻略/票价等演示数据准备。

### 7.2 小程序端验收
- 登录：首次登录自动建档；二次登录识别同一用户；可修改昵称。
- 首页：Banner 可展示且点击仅跳景点详情；热门列表可用；猜你喜欢可用并按规则过滤。
- 景点：列表筛选/排序/分页可用；搜索可模糊匹配；详情信息完整；导航跳转可用。
- 攻略：列表/详情可用且图文渲染正常。
- 评分：随时可评；可更新；影响推荐。
- 订单：完整状态（待支付/待使用/已完成/已取消）可展示与筛选；模拟支付/取消幂等；后台可标记完成并同步到用户端。
- 个人中心：收藏/订单入口可用；客服入口不报错。

### 7.3 管理后台验收
- 管理员登录可用；受限页面拦截生效。
- 景点/攻略发布或编辑后，小程序端可见对应变化。
- 订单列表可查看并支持将待使用标记为已完成。
- 用户列表可查看。

### 7.4 推荐效果（论文口径，最小要求）
- 以“热门/标签推荐”为 baseline；在同一测试集上，ItemCF 在 Precision@10/Recall@10 或 RMSE 上优于 baseline（或给出合理对比与解释）。

---

## 8. 里程碑与交付物
### 8.1 里程碑（与任务书进度对齐）
- 2025-12-05 ~ 2026-03-08：选题/文献/开题
- 2026-03-09 ~ 2026-03-31：可行性/需求/设计
- 2026-04-01 ~ 2026-04-20：编码实现
- 2026-04-21 ~ 2026-04-30：测试与文档
- 2026-05-01 ~ 2026-05-20：论文与答辩准备

### 8.2 交付物（本期）
- Requirement.md（本文件）
- 源代码（小程序端 + 后端 + 后台）
- 测试报告（黑盒 + 白盒）
- 演示数据（SQL 脚本）
- 论文/说明文档（按学校要求）

---

## 9. 术语表
- **ItemCF**：Item-based Collaborative Filtering，基于物品相似度的协同过滤推荐。
- **Cold Start（冷启动）**：用户交互不足时的推荐策略（本项目为热门/最新 + 偏好标签引导）。
- **PGC**：Professionally Generated Content，由平台/管理员生产的内容。
- **Top-N**：推荐系统输出的前 N 个结果。
- **wx.login / wx.openLocation**：微信小程序开放接口，用于登录与导航跳转。

---

## 10. 变更记录
- v1.0：规范化目录、编号与术语；合并重复表述；保持 v0.6 已确认需求不变。
- v0.6：补充初始数据导入方式、Banner 跳转范围、评分时机。
- v0.5：补全订单状态与流转；定稿猜你喜欢过滤规则；补充列表分页通用需求。
- v0.4：融合“功能需求详解”，明确登录流程、首页结构、导航方式、PGC 攻略与 AI 预留、模拟支付流程与后台四模块。
