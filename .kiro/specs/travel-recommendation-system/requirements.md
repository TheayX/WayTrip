# 需求文档

## 简介

本系统是一个基于协同过滤推荐算法的个性化旅游推荐系统，包含基于 Uni-app 的跨端小程序（用户端）和 Web 管理后台（管理端）。系统通过 ItemCF 算法实现个性化景点推荐，支持用户浏览、搜索、收藏、评分、下单等功能，并配套管理后台进行内容维护与数据管理。

## 术语表

- **用户端**: 基于 Uni-app + Vue.js 3 + Pinia 开发的跨端小程序，面向普通用户的移动端应用
- **管理后台**: 基于 Vue.js 3 + Element Plus + Axios 开发的 Web 管理后台，面向管理员的内容管理系统
- **推荐引擎**: 基于物品相似度的协同过滤推荐引擎（ItemCF）
- **认证服务**: 用户认证服务，处理登录注册逻辑
- **景点服务**: 景点服务，管理景点数据的增删改查
- **攻略服务**: 攻略服务，管理旅游攻略内容
- **订单服务**: 订单服务，处理订单创建、支付、取消等流程
- **评分服务**: 评分服务，处理用户对景点的评分与评论
- **收藏服务**: 收藏服务，管理用户收藏列表
- **冷启动策略**: 用户交互不足时的推荐方案（热门/最新 + 偏好标签引导）
- **OpenID**: 微信用户唯一标识符
- **Top_N**: 推荐系统输出的前 N 个推荐结果

## 需求列表

### 需求 1：用户认证

**用户故事：** 作为用户，我希望能够一键登录小程序，以便快速访问个性化功能，无需复杂的注册流程。

#### 验收标准

1. 当用户打开小程序并触发登录时，认证服务应调用 wx.login 获取 code 并换取 OpenID 和 SessionKey
2. 当 OpenID 在数据库中不存在时，认证服务应自动创建新用户记录并完成登录流程
3. 当 OpenID 在数据库中已存在时，认证服务应直接完成用户认证，不创建重复记录
4. 当用户访问个人中心页面时，用户端应显示当前昵称和头像
5. 当用户在个人中心修改昵称时，认证服务应更新用户记录并立即生效

### 需求 2：首页与轮播图

**用户故事：** 作为用户，我希望在首页看到精选内容，以便快速发现热门景点。

#### 验收标准

1. 当用户打开首页时，用户端应显示管理员配置的轮播图内容
2. 当用户点击轮播图项时，用户端应仅跳转到对应的景点详情页
3. 当用户查看首页时，用户端应显示基于全局热度排名的热门推荐区域
4. 当用户点击热门推荐项时，用户端应跳转到景点详情页
5. 当用户在首页执行下拉刷新操作时，用户端应触发推荐内容刷新并显示最新推荐结果

### 需求 3：个性化推荐（ItemCF）

**用户故事：** 作为用户，我希望获得个性化的景点推荐，以便发现符合我偏好的地方。

#### 验收标准

1. 当用户有足够的交互记录（评分数量 >= 3）时，推荐引擎应计算并返回 Top-N 个性化推荐列表
2. 当用户交互记录不足（评分数量 < 3）时，冷启动策略应显示热门/最新景点，并引导用户选择偏好标签
3. 当为用户生成推荐时，推荐引擎应过滤掉用户已评分、已收藏或已下单（不含已取消订单）的景点
4. 当用户取消了某景点的订单时，推荐引擎应允许该景点再次出现在推荐列表中
5. 当用户点击刷新按钮时，用户端应请求并显示新一批推荐结果
6. 对于有足够交互记录的用户，推荐引擎生成的推荐列表应与全局热门列表有所不同

### 需求 4：景点浏览与搜索

**用户故事：** 作为用户，我希望能够浏览和搜索景点，以便找到我感兴趣的地方。

#### 验收标准

1. 当用户查看景点列表时，景点服务应支持按地区和类型/主题筛选
2. 当用户查看景点列表时，景点服务应支持按热度、评分和价格排序
3. 当用户滚动到景点列表底部时，用户端应通过分页加载更多项目
4. 当用户输入搜索关键词时，景点服务应返回名称匹配关键词的景点（模糊搜索）
5. 当没有景点匹配搜索关键词时，用户端应显示"暂无结果"提示
6. 当用户查看景点详情页时，用户端应显示图片、简介、票价、开放时间和地址
7. 当用户查看景点详情页时，用户端应展示该景点的最新评论列表
8. 当用户点击景点详情页的导航按钮时，用户端应调用 wx.openLocation 并传入景点的经纬度、名称和地址
9. 如果用户拒绝位置权限，用户端仍应使用目的地坐标打开导航页面

### 需求 5：旅游攻略（PGC）

**用户故事：** 作为用户，我希望阅读旅游攻略，以便获取有用的旅行规划信息。

#### 验收标准

1. 当用户查看攻略列表时，攻略服务应返回管理员发布的攻略，支持按分类或时间排序
2. 当用户滚动到攻略列表底部时，用户端应通过分页加载更多项目
3. 当用户点击攻略项时，用户端应显示攻略详情，正确渲染富文本和图片
4. 当管理员下架攻略时，用户端不应在列表中显示该攻略，或显示不可用提示
5. 当用户查看攻略详情页时，用户端应展示攻略关联的景点列表，支持点击跳转到景点详情页进行购票

### 需求 6：评分与评论

**用户故事：** 作为用户，我希望对景点进行评分和评论，以便分享我的体验并帮助改进推荐。

#### 验收标准

1. 当用户为景点提交评分（1-5分）时，评分服务应保存评分并关联用户和景点
2. 当用户为已评分的景点再次提交评分时，评分服务应用新值更新现有评分
3. 当用户为景点提交文字评论时，评分服务应保存评论并在景点详情页显示
4. 当评分提交后，推荐引擎应在后续推荐计算中包含该评分数据

### 需求 7：收藏管理

**用户故事：** 作为用户，我希望将景点保存到收藏夹，以便日后轻松找到它们。

#### 验收标准

1. 当用户点击景点的收藏按钮时，收藏服务应将该景点添加到用户的收藏列表
2. 当用户点击已收藏景点的收藏按钮时，收藏服务应将该景点从用户的收藏列表中移除
3. 当用户查看收藏列表时，用户端应显示所有已收藏的景点，并可跳转到详情页
4. 当收藏状态改变时，用户端应立即反映更新后的状态

### 需求 8：订单创建与管理

**用户故事：** 作为用户，我希望创建和管理门票订单，以便规划我的景点游览。

#### 验收标准

1. 当用户提交包含游玩日期、数量和联系人信息的订单时，订单服务应创建状态为"待支付"的订单
2. 当用户查看订单列表时，用户端应显示订单并支持按状态筛选（全部、待支付、已支付、已取消、已退款、已完成）
3. 当用户滚动到订单列表底部时，用户端应通过分页加载更多项目
4. 当用户点击订单时，用户端应显示完整的订单详情，包括景点信息、游玩日期、数量和状态

### 需求 9：模拟支付

**用户故事：** 作为用户，我希望完成订单支付，以便确认我的门票预订。

#### 验收标准

1. 当用户点击待支付订单的支付按钮时，订单服务应显示模拟支付加载界面
2. 当模拟支付成功完成时，订单服务应将订单状态从"待支付"更新为"已支付"
3. 当用户多次点击支付按钮时，订单服务应确保幂等行为，不产生重复支付结果
4. 当订单状态改变时，用户端应持久化新状态，刷新后不回退

### 需求 10：订单取消

**用户故事：** 作为用户，我希望在需要时取消订单，以便更改我的旅行计划。

#### 验收标准

1. 当订单处于"待支付"或"已支付"状态时，订单服务应允许用户取消订单
2. 当用户取消订单时，订单服务应将订单状态更新为"已取消"
3. 当订单处于"已完成"状态时，订单服务不应允许取消
4. 当用户尝试取消已取消的订单时，订单服务应幂等处理请求，不报错
5. 当订单被取消时，用户端应在订单列表和详情视图中同步状态

### 需求 11：订单完成与退款（管理端）

**用户故事：** 作为管理员，我希望将订单标记为已完成或进行退款，以便在服务交付后关闭订单或处理用户退款请求。

#### 验收标准

1. 当管理员将"已支付"订单标记为已完成时，订单服务应将订单状态更新为"已完成"
2. 当管理员更新订单状态时，用户端应向用户显示更新后的状态
3. 订单服务不应允许状态从"已完成"回退到"已支付"
4. 当管理员对"已支付"订单执行退款操作时，订单服务应将订单状态更新为"已退款"

### 需求 12：个人中心

**用户故事：** 作为用户，我希望访问我的个人信息和相关功能，以便管理我的账户。

#### 验收标准

1. 当用户打开个人中心页面时，用户端应显示昵称、头像和偏好标签（如已设置）
2. 当用户点击订单入口时，用户端应跳转到订单列表页面
3. 当用户点击收藏入口时，用户端应跳转到收藏列表页面
4. 当用户点击客服入口时，用户端应打开客服界面（电话、二维码或静态页面），不报错

### 需求 13：管理员认证

**用户故事：** 作为管理员，我希望安全地登录管理后台，以便访问管理功能。

#### 验收标准

1. 当管理员提交有效凭据时，管理后台应完成认证并授予仪表板访问权限
2. 当未认证用户尝试访问受保护页面时，管理后台应重定向到登录页面
3. 管理后台应使用 BCrypt 加密存储管理员密码

### 需求 14：景点管理（管理端）

**用户故事：** 作为管理员，我希望管理景点数据，以便保持内容最新。

#### 验收标准

1. 当管理员创建包含必填字段（含经纬度）的新景点时，景点服务应保存景点记录
2. 当管理员编辑景点时，景点服务应更新记录并在用户端反映变化
3. 当管理员更改景点的发布状态时，用户端应相应地显示或隐藏该景点
4. 当管理员查看景点列表时，管理后台应支持分页

### 需求 15：攻略管理（管理端）

**用户故事：** 作为管理员，我希望管理旅游攻略，以便为用户提供有用的内容。

#### 验收标准

1. 当管理员创建包含富文本内容的新攻略时，攻略服务应保存攻略记录
2. 当管理员编辑攻略时，攻略服务应更新记录并在用户端反映变化
3. 当管理员更改攻略的发布状态时，用户端应相应地显示或隐藏该攻略

### 需求 16：订单管理（管理端）

**用户故事：** 作为管理员，我希望查看和管理订单，以便监控业务运营。

#### 验收标准

1. 当管理员查看订单列表时，管理后台应显示所有订单，支持按时间或状态筛选
2. 当管理员点击订单时，管理后台应显示完整的订单详情
3. 当管理员查看订单列表时，管理后台应支持分页

### 需求 17：用户管理（管理端）

**用户故事：** 作为管理员，我希望查看注册用户，以便监控用户增长。

#### 验收标准

1. 当管理员查看用户列表时，管理后台应显示用户信息，包括昵称和注册时间
2. 管理后台不应在前端显示中暴露 OpenID 等敏感标识符
3. 当管理员查看用户列表时，管理后台应支持分页

### 需求 18：非功能性需求

**用户故事：** 作为系统运营者，我希望系统满足性能和安全标准，以便用户获得可靠的体验。

#### 验收标准

1. 当用户加载首页时，用户端应在 1.0 秒内完成渲染（P95）
2. 当用户执行搜索时，景点服务应在 2.0 秒内返回结果（P95）
3. 当用户请求推荐时，推荐引擎应在 0.8 秒内返回结果（P95）
4. 认证服务应对所有来自用户端的 API 请求使用基于 token 的认证
5. 系统不应在应用日志中记录包括 OpenID 在内的敏感信息
6. 当订单操作期间发生网络错误时，订单服务应支持重试且不创建重复记录

### 需求 19：数据统计与仪表板（管理端）

**用户故事：** 作为管理员，我希望查看系统运营数据概览，以便了解平台整体运营状况。

#### 验收标准

1. 当管理员打开仪表板页面时，管理后台应展示核心统计数据（总用户数、总景点数、总订单数、总收入）
2. 当管理员查看仪表板时，管理后台应展示当日新增用户数、当日订单数和当日收入
3. 当管理员查看订单趋势时，管理后台应展示近 N 天的订单数量和收入趋势图
4. 当管理员查看热门景点排行时，管理后台应展示按订单数排名的景点列表
